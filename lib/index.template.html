<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>Perfy — because performance matters</title>
    <script src="lib/plotly.min.js"></script>
    <script defer src="https://code.getmdl.io/1.2.1/material.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.pink-purple.min.css" />
    <style>
        .mdl-card {
            width: 95%;
            margin: 10px;
        }
        
        .page-content {
            display: flex;
            align-self: flex-start;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div class="mdl-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">Perfy — because performance matters</span>
                <div class="mdl-layout-spacer"></div>
                <nav class="mdl-navigation mdl-layout--large-screen-only">
                    <!--<a class="mdl-navigation__link" href="">Link</a>-->
                </nav>
            </div>
        </header>
        <main class="mdl-layout__content">
            <div class="page-content" id="canvas"></div>
        </main>
    </div>

    <script>
        load(###FILES###)
            .then((metrics) => {

                const canvas = document.getElementById('canvas');
                const colors = [
                    'f44336',
                    '2196F3',
                    '6200EA',
                    'C51162',
                    '880E4F',
                    'AEEA00',
                    '3E2723'
                ];

                Object.keys(metrics[0].validSample[0].values).map((metricName) => {
                    draw(metricName);
                });

                function draw(metricName) {
                    const data = [];
                    metrics.map((f, i) => {
                        data.push({
                            x: f.validSample.map(sample => sample.runIndex),
                            y: f.validSample.map(sample => sample.values[metricName]),
                            name: f.description.id,
                            marker: {
                                color: colors[i] ? colors[i] : 'black'
                            },
                            line: {
                                width: 1
                            },
                            type: 'scatter'
                        });
                    })

                    const layout = {
                        title: metrics[0].description.metrics[metricName],
                        xaxis: {
                            title: 'Run Index',
                            showticklabels: true,
                            tickfont: {
                                size: 14,
                                color: 'rgb(107, 107, 107)'
                            },
                            rangemode: 'nonnegative'
                        },
                        yaxis: {
                            title: metricName,
                            titlefont: {
                                size: 16,
                                color: 'rgb(107, 107, 107)'
                            },
                            tickfont: {
                                size: 14,
                                color: 'rgb(107, 107, 107)'
                            },
                            rangemode: 'nonnegative'
                        },
                        legend: {
                            x: 0,
                            y: 1.0,
                            bgcolor: 'rgba(255, 255, 255, 0)',
                            bordercolor: 'rgba(255, 255, 255, 0)'
                        },
                        mode: 'markers',
                        marker: {
                            size: 7,
                            line: {
                                width: 0.5
                            },
                            opacity: 0.8
                        }
                    };

                    const dom = document.createElement('div');
                    dom.setAttribute('class', 'mdl-card mdl-shadow--4dp');
                    dom.innerHTML = `<div class="mdl-card__supporting-text" id="${metricName}"></div>`;
                    canvas.appendChild(dom);
                    Plotly.plot(document.getElementById(metricName), data, layout, {
                        showLink: false
                    });
                }
            });

        function load(files) {
            return Promise.all(
                files.map(f => {
                    return new Promise((resolve, reject) => {
                        const xhr = new XMLHttpRequest();
                        const handle = () => resolve(JSON.parse(xhr.response));
                        xhr.addEventListener('load', handle);
                        xhr.open('GET', f);
                        xhr.send();
                    });
                })
            );
        }
    </script>

</body>

</html>